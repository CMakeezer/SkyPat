\documentclass[final]{ols}
\usepackage{color,framed,url,zrl}
\usepackage[colorlinks=true]{hyperref}
\definecolor{shadecolor}{rgb}{0.9,0.9,0.9}
\ifpdf\usepackage[pdftex]{graphicx}\else\usepackage{graphicx}\fi

\begin{document}

\title{SkyPat: C++ Performance Analysis and Testing Framework}
\subtitle{}

\author{
	Ping-Hao Chang \\
	{\em Skymizer}\\
	{\tt\small peter@skymizer.com}\\
\and
	Luba Tang\\
	{\em Skymizer}\\
	{\tt\small luba@skymizer.com}\\
\and
	Kuan-Hung Kuo\\
	{\em Skymizer}\\
	{\tt\small ggm@skymizer.com}\\
\and
	Der-Yu Tsai\\
	{\em Skymizer}\\
	{\tt\small a127a127@skymizer.com}\\
\and
	Kevin Chen\\
	{\em Skymizer}\\
	{\tt\small kevin@skymizer.com}
}
\shortauthor{P.H.\ Chang \& L.\ Tang \& K.H.\ Kuo \& D.Y.\ Tsai \& K.\ Chen}

\date{} % Do not print the date

\maketitle

%\thispagestyle{empty} % Do not use \thispagestyle in your paper.

\begin{abstract}
This paper introduces SkyPat, a C++ performance analysis toolkit on Linux. 
SkyPat combines unit tests and perf\_event to give programmers the power of white-box performance analysis.

SkyPat behaves like a normal unit test library. 
It provides macros and assertions to ensure correctness and to evaluate performance of a region of code. 
We want to point out that, under the high reliability, the evaluation is precise. 
With perf\_event, SkyPat can analyze running time of a region without interference to scheduler. 
Moreover, perf\_event also gives SkyPat precise cycle counts that are useful for tools who are sensitive to variance of timing, such as compilers.
With pure and precise timing information, SkyPat helps to measure the bottleneck of regions of a program.

We develop SkyPat under the new BSD license, and it's also the unit-test library of the "bold" project.
\end{abstract}

\section{Introduction}
Accuracy and performance evaluation are two important issues for programmers.
First, accuracy ensures that program can behave like what programmer wants it behaves and it is not easy to be ensured. 
For example, if a compiler compiles source-code fast but its result contains lots of error, this compiler is useless.
In order to ensure accuracy, programmers usually write lots of unit-tests to verify their program.
Second, performance evaluation is another important issues for programmers.
Programmers always hope program executing as fast as possible.
Using performance evaluation tool can evaluate its runtime behavior. 
Performance evaluation tool, such as \textit{perf} \cite{perf-tools}, can evaluate runtime behavior with the help of OS-support and hardware-support.

In the past, unit-test tool and performance evaluation tool are different tools. 
For example, \textit{GoogleTest} \cite{Google-test} is well-known C++ unit-test framework.
GoogleTest can evaluate accuracy but cannot evaluate performance. 
Meanwhile, \textit{perf} is well-known performance evaluation toolkit in Linux. 
\textit{perf} can evaluate performance of programs, including its running time, cycles and so on.
Although \textit{perf} can evaluate whole program, \textit{perf} cannot evaluate performance of region of code.

In this paper, we introduces SkyPat, which combines unit-test and performance evaluation.
Programmer only need to write and execute unit-tests and they can get accuracy and performance.
Furthermore, with the help of perf\_event of Linux kernel, SkyPat can provide cycle-level accuracy precise timer.
By integrating unit-test and performance evaluation, SkyPat can let programmer evaluate performance and accuracy more easier than before.

The rest of this paper will be organized as follows. 
Related works is discussed in Section 2. 
Our design and implementation is presented in Section 3.
Evaluation is shown in Section 4.
At last, we conclude this paper in Section 5.

\section{Related work}

There are several existing evaluation tools for performance and accuracy.
Some tools focus on performance evaluation, such as Oprofile\cite{oprofile} and ``perf''. 
Oprofile is performance evaluation tool for whole system and single program.
Oprofile was based on sampling-based by creating a daemon to collect runtime information for versions 0.9.7 and earlier.
Because sampling-based daemon will waste system resource, Linux community added new interface, called ``Performance Counter''\cite{performance-counter-linux} or ``perf\_event'' in later version.
With the help of ``Performance Counter'', Linux community builds another performance evaluation tool, called ``perf'', based on ``Performance Counter''. 
``perf'' is a performance evaluation toolkit without daemon to collect runtime information, such as cycle-count, the value of ``vruntime'' in scheduler, call-graph, branch-miss, cache-miss, and so on.
Because ``perf'' gets runtime information by kernel rather than collecting from daemon, ``perf'' doesn't create lots of overhead for profiling.
Although these performance evaluation tool can evaluate program's performance, they cannot monitor the performance of the region of code and cannot integrate with unit-test system.

Other tools are unit-test framework focusing on accuracy, such as GoogleTest.
GoogleTest is a xUnit test framework for C++ program.
With the help of providing ASSERT and EXPECT macros, GoogleTest let programmer be able to verify program's accuracy by writing test-case.
When executing test-cases, program will stop if it faces fatal error. 
If program faces non-fatal error, program will show the runtime value and expected value on the screen to programmer.

\section{Design and Implemenation}

\section{Evaluation}

\section{Conclusion}

\begin{thebibliography}{99}  % The section of reference
\addcontentsline{toc}{section}{Reference}  % Add ``Reference'' into the table of contents
\bibitem{perf-tools}
Arnaldo Carvalho de Melo, Redhat, ``The New Linux `perf' tools'' in \emph{17 International Linux System Technology Conference (Linux Kongress), 2010}

\bibitem{Google-test}
GoogleTest, Google, \texttt{\small https://code.google.com/p/googletest/}

\bibitem{oprofile}
Oprofile, \texttt{\small http://oprofile.sourceforge.net/about/}

\bibitem{performance-counter-linux}
Ingo Molnar, ``Performance Counters for Linux'' in \emph{Linux Weekly News, 2009}, \texttt{\small http://lwn.net/Articles/337493/}

\end{thebibliography}

\end{document}
